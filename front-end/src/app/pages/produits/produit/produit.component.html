<div class="product-page">
  <!-- Section En-tête de Produit E-commerce (Hero Banner avec carrousel) -->
  <section class="hero-banner" [@fadeIn]>
    <div class="hero-carousel">
      <!-- Slides d'images -->
      <div
        class="hero-slide"
        *ngFor="let slide of heroSlides; let i = index"
        [class.active]="i === currentHeroIndex"
        [style.backgroundImage]="'url(' + slide + ')'">
      </div>

      <!-- Overlay de couleur pour lisibilité du texte -->
      <div class="hero-overlay"></div>

      <!-- Contenu texte + filtres en avant-plan -->
      <div class="container hero-inner">
        <div class="hero-copy">
          <span class="hero-kicker">Ahma-Dile • Tissus & Mercerie</span>
          <h1>Imaginez, cousez, créez.</h1>
          <p class="subtitle">
            Wax, bazin, dentelle, mercerie et accessoires sélectionnés avec soin pour vos plus belles
            créations.
          </p>

          <div class="hero-chips">
            <button type="button" class="chip" [class.active]="activeFilter === 'all'" (click)="setFilter('all')">Tout</button>
            <button type="button" class="chip" [class.active]="activeFilter === 'tissu'" (click)="setFilter('tissu')">Tissus</button>
            <button type="button" class="chip" [class.active]="activeFilter === 'mercerie'" (click)="setFilter('mercerie')">Mercerie</button>
          </div>

        </div>

        <!-- Contrôles du carrousel -->
        <div class="hero-controls" aria-hidden="true">
          <button type="button" class="hero-arrow left" (click)="prevHeroSlide()">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button type="button" class="hero-arrow right" (click)="nextHeroSlide()">
            <i class="fas fa-chevron-right"></i>
          </button>

          <div class="hero-dots">
            <button
              *ngFor="let slide of heroSlides; let i = index"
              type="button"
              class="hero-dot"
              [class.active]="i === currentHeroIndex"
              (click)="goToHeroSlide(i)"></button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Section dédiée au bouton Ajouter un produit (Admin uniquement) -->
  <section class="admin-actions-section" *ngIf="isAdmin">
    <div class="container">
      <div class="add-product-card">
        <h3>Gérez votre inventaire</h3>
        <p>Zone réservée à l'équipe Alma-Dile pour ajouter et organiser les produits.</p>

        <button
          type="button"
          class="btn-add-product"
          routerLink="/produits/ajouter"
        >
          <i class="fas fa-plus-circle"></i> Ajouter un nouveau produit
        </button>
      </div>
    </div>
  </section>

  <!-- Section Liste de Produits E-commerce (Main Content) -->
  <div class="container main-content" id="products-section">

    <div class="catalog-layout">
      <aside class="filters-sidebar">
        <div class="filters-header">
          <h3>Filtres</h3>
          <button class="filters-reset" type="button" (click)="resetFilters()" [disabled]="!hasActiveFilters()">
            Réinitialiser
          </button>
        </div>

        <div class="filter-block">
          <label class="filter-label">Catégorie</label>
          <select [ngModel]="activeCategoryId" (change)="onCategoryChange($event)">
            <option value="all">Toutes les catégories</option>
            <option *ngFor="let c of categories" [value]="c.id">{{ c.nom }}</option>
          </select>
        </div>

        <div class="filter-block">
          <label class="filter-label">Type</label>
          <div class="filter-buttons vertical">
            <button type="button" [class.active]="activeFilter === 'all'" (click)="setFilter('all')">Tous</button>
            <button
              type="button"
              *ngFor="let type of getUniqueTypes()"
              [class.active]="activeFilter === type"
              (click)="setFilter(type)"
            >
              {{type}}
            </button>
          </div>
        </div>

        <div class="filter-block">
          <label class="checkbox-row">
            <input type="checkbox" [(ngModel)]="inStockOnly" (change)="filterProducts()" />
            <span>En stock uniquement</span>
          </label>
        </div>

        <div class="filter-block">
          <label class="filter-label">Prix</label>
          <div class="price-range">
            <input type="number" [(ngModel)]="minPrice" (input)="filterProducts()" placeholder="Min" />
            <input type="number" [(ngModel)]="maxPrice" (input)="filterProducts()" placeholder="Max" />
          </div>
        </div>
      </aside>

      <section class="catalog-content">
        <div class="catalog-toolbar">
          <div class="search-bar">
            <i class="fas fa-search"></i>
            <input
              type="text"
              [(ngModel)]="searchTerm"
              (input)="onSearchChange()"
              placeholder="Rechercher un produit (nom, description...)"
            />
          </div>

          <div class="toolbar-actions">
            <select [(ngModel)]="sortOption" (change)="onSortChange($event)">
              <option value="default">Trier par</option>
              <option value="name">Nom (A-Z)</option>
              <option value="price-low">Prix croissant</option>
              <option value="price-high">Prix décroissant</option>
            </select>
          </div>
        </div>

        <div class="results-meta">
          <span class="results-count">{{ filteredProduits.length }} produit(s)</span>
        </div>

        <div class="products-grid" [@stagger]>
          <div *ngFor="let produit of paginatedProduits; trackBy: trackByFn" class="product-card">
            <div class="product-badges">
              <div class="product-badge" *ngIf="isLowStock(produit.quantite)">
                Stock limité
              </div>
              <div class="product-badge discount" *ngIf="produit.prix > 100">
                Promo
              </div>
            </div>

            <div class="product-image-wrapper">
              <img
                [src]="
                  produit.image
                    ? 'http://127.0.0.1:8000/storage/' + produit.image
                    : 'assets/images/no-image.jpg'
                "
                [alt]="produit.nom"
                (error)="onImageError($event)"
              />
              <button type="button" class="quick-view" (click)="quickView(produit)">
                <i class="fas fa-eye"></i> Vue rapide
              </button>
            </div>

            <div class="product-info">
              <div class="rating">
                <span *ngFor="let star of [1, 2, 3, 4, 5]">★</span>
              </div>

              <h3 class="product-name" (click)="goToProductDetail(produit)">{{produit.nom}}</h3>
              <p class="product-type">{{produit.type}}</p>

              <div class="price-container">
                <span class="current-price">{{formatPrice(produit.prix)}}</span>
                <span *ngIf="produit.prix > 100" class="old-price">{{formatPrice(produit.prix + 50)}}</span>
              </div>

              <div class="product-actions">
                <button class="details-btn" type="button" [routerLink]="['/produits', produit.id]">
                  <i class="fas fa-info-circle"></i> Détails
                </button>
                <button
                  type="button"
                  class="add-to-cart-btn add-btn-{{produit.id}}"
                  (click)="addToCart(produit, 1)"
                  [disabled]="isOutOfStock(produit.quantite)"
                >
                  <i class="fas fa-shopping-cart"></i>
                  {{ isOutOfStock(produit.quantite) ? 'Rupture' : 'Ajouter' }}
                </button>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="!isLoading && filteredProduits.length === 0" class="empty-state">
          <i class="fas fa-search fa-3x"></i>
          <h4>Nous n'avons rien trouvé pour cette recherche</h4>
          <p>Modifiez vos filtres ou élargissez votre recherche pour découvrir plus de tissus.</p>
          <button class="btn-primary" (click)="resetFilters()">
            Réinitialiser
          </button>
        </div>
      </section>
    </div>

    <!-- Pagination Section -->
    <div class="pagination" *ngIf="filteredProduits.length > 0">
      <button
        class="pagination-btn"
        [class.disabled]="currentPage === 1"
        (click)="prevPage()"
        type="button"
      >
        &laquo; Précédent
      </button>

      <button
        *ngFor="let p of pages"
        class="pagination-btn"
        [class.active]="p === currentPage"
        type="button"
        (click)="setPage(p)"
      >
        {{ p }}
      </button>

      <button
        class="pagination-btn"
        [class.disabled]="currentPage === totalPages"
        (click)="nextPage()"
        type="button"
      >
        Suivant &raquo;
      </button>
    </div>

    <!-- Sélection de la semaine (carrousel horizontal) -->
    <section class="weekly-section" *ngIf="filteredProduits.length > 0">
      <div class="weekly-header">
        <h2>Sélection de la semaine</h2>
        <span class="weekly-subtitle">Quelques tissus et mercerie mis en avant pour vous inspirer.</span>
      </div>

      <div class="weekly-scroller">
        <div
          class="weekly-item"
          *ngFor="let produit of filteredProduits | slice:0:10"
          (click)="goToProductDetail(produit)">
          <div class="weekly-image-wrapper">
            <img
              [src]="
                produit.image
                  ? 'http://127.0.0.1:8000/storage/' + produit.image
                  : 'assets/images/no-image.jpg'
              "
              [alt]="produit.nom"
              (error)="onImageError($event)"
            />
          </div>
          <div class="weekly-info">
            <h3 class="weekly-name">{{ produit.nom }}</h3>
            <p class="weekly-price">{{ formatPrice(produit.prix) }}</p>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Section CTA (Newsletter) -->
  <section class="cta-section">
    <div class="container">
      <div class="cta-content">
        <h2>Recevez nos nouveautés et promotions</h2>
        <p>Pas de spam, uniquement l'essentiel pour vos futures créations.</p>
        <form class="cta-form" (submit)="$event.preventDefault()">
          <input type="email" placeholder="Votre adresse email" required />
          <button type="submit" class="btn-primary">S'abonner</button>
        </form>
      </div>
    </div>
  </section>

  <!-- Section Catégories (Existante) -->
  <section class="categories-section" *ngIf="!isLoadingCategories">
    <div class="container">
      <h2>Nos collections</h2>
      <p class="section-subtitle">Découvrez nos tissus par catégories</p>

      <div class="categories-grid">
        <div
          *ngFor="let category of featuredCategories"
          class="category-card"
          [style.backgroundImage]="'url(' + (category.imageUrl || 'assets/images/default-category.jpg') + ')'"
        >
          <div class="category-content">
            <h3>{{category.nom}}</h3>
            <button
              class="btn-category"
              [routerLink]="['/categories', category.id]"
            >
              Explorer
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>